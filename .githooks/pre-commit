#!/usr/bin/env zsh
set -o errexit # block commit if there are any issues reported
cd "$(git rev-parse --show-toplevel)"
#───────────────────────────────────────────────────────────────────────────────

echo "Pre-Commit Hook"

echo "(1/5) Biome"
if [[ "$1" == "check-all" ]]; then
	npx biome check --write --error-on-warnings --log-kind="compact"
else
	# `--staged` so unused things in unstaged files does not block commit
	npx biome check --error-on-warnings --staged --no-errors-on-unmatched --log-kind="compact"
fi

echo "(2/5) TypeScript"
npx tsc --noEmit --skipLibCheck --strict
echo "✅"

echo "(3/5) Obsidian ESLint"
npx eslint src
echo "✅"

echo "(4/5) Knip"
npx knip
test -t || echo "✅" # when running in terminal, knip already has output

echo "(5/5) Markdownlint"
npx markdownlint --ignore="node_modules" .
echo "✅"
echo
