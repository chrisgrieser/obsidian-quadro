#!/usr/bin/env zsh
# vim: filetype=sh
#───────────────────────────────────────────────────────────────────────────────

# INFO block commit if there are any issues reported
set -o errexit

# print color if stdout is a terminal
function colored_print {
	local color=${2:-\\033[1;35m}
	local msg="$1"
	if [[ -t true ]]; then
		print "$color$msg\033[0m"
	else
		print "$msg"
	fi
}

function print_line {
	if [[ -t true ]]; then
		echo "────────────────────────"
	else
		echo "------------------------"
	fi
}

#───────────────────────────────────────────────────────────────────────────────

print_line
colored_print "Pre-Commit Hook" "\\033[1;34m"

colored_print "(1/4) Biome"
npx biome check --log-kind="compact" "$(git rev-parse --show-toplevel)"

colored_print "(2/4) TypeScript"
npx tsc --noEmit --skipLibCheck --strict
echo "Done."

colored_print "(3/4) esbuild"
node esbuild.config.mjs

colored_print "(4/4) Markdownlint"
npx markdownlint --ignore="node_modules" "$(git rev-parse --show-toplevel)"
echo "Done."

print_line
